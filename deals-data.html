<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>Deals | Bristol Farms</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Place favicon.ico in the root directory -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600|Raleway:400,600,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=block" rel="stylesheet">
  <link href="./css/vendor/fontawesome.css" rel="stylesheet">
  <link rel="stylesheet" href="./css/vendor/flatpickr.min.css">
  <link rel="stylesheet" href="./css/vendor/materialize.min.css">
  <link rel="stylesheet" href="css/styles.css">

  <meta name="theme-color" content="#fafafa">
</head>

<body class="left-menu-fixed">

  <div class="body-container-wrapper">
    <div class="body-wrapper">

      <!-- Header -->
      <header class="header-container">
        <div class="header-container-wrapper">
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-10 header-left-wrapper">
                <div class="cell-wrapper">
                  <div class="header-title-nav-wrapper">
                    <div class="title">
                      <h3>Deals</h3>
                      <div aria-label="breadcrumb">
                        <ol class="breadcrumb">
                          <li class="breadcrumb-item"><a href="/">Home</a></li>
                          <li class="breadcrumb-item active" aria-current="page">Deals</li>
                        </ol>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-2 header-right-wrapper text-right">
                <div class="cell-wrapper">
                  <div class="header-dropdown-wrapper">
                    <a href="javascript:;" class="header-dropdown-trigger"><i class="far fa-user-circle"></i></a>
                    <div class="dropdown-menu text-left">
                      <div class="header-dropdown-user-profile-wrapper text-center">
                        <div class="user-avatar-wrapper">
                          <i class="far fa-user-circle"></i>
                        </div>
                        <div class="user-detail-wrapper">
                          <h3><a href="javascript:;">User Name</a></h3>
                          <h5>Admin</h5>
                        </div>
                      </div>
                      <ul>
                        <li><a href="javascript:;">Menu 1</a></li>
                        <li><a href="javascript:;">Menu 2</a></li>
                        <li><a href="javascript:;">Menu 3</a></li>
                        <li><a href="javascript:;">Logout</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Left Menu -->
      <div class="left-menu-wrapper"></div>

      <!-- Main Body Content -->
      <div class="main-body-content-wrapper">
        <div class="main-body-content-container">
          <div class="header-search-wrapper">
            <div class="container-fluid">
              <div class="card header-search-card-wrapper">
                <div class="card-content">
                  <h3 class="card-title">Deal Import</h3>
                  <div class="row justify-content-center align-items-center">
                    <div class="col-lg-2 col-md-4">
                      <div class="cell-wrapper">
                        <div class="button-wrapper">
                          <a href="javascrip:;" class="button-primary button-icon-left button-outline button-block"><i class="fas fa-file-download"></i> Download Template</a>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-5 col-md-4">
                      <div class="cell-wrapper">
                        <div class="file-field input-field">
                          <div class="btn button-primary button-icon-left">
                            <span><i class="fas fa-file-upload"></i> Upload File</span>
                            <input type="file">
                          </div>
                          <div class="file-path-wrapper">
                            <input class="file-path validate" type="text">
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-2 col-md-4">
                      <div class="cell-wrapper">
                        <div class="button-wrapper">
                          <a href="javascrip:;" class="button-primary button-block">Submit</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="main-body-data-wrapper">
            <div class="container-fluid">
              <div class="card">
                <div class="card-content">
                  <div class="card-header d-flex flex-row justify-content-between align-items-center">
                    <div class="card-title-wrapper">
                      <h3 class="card-title">Deals<br><small>Double Click on row to edit.</small></h3>
                    </div>
                    <div class="card-header-action-wrapper" id="cardHeaderAction">
                      <div class="button-wrapper d-flex flex-row justify-content-end align-items-center">
                        <div class="input-field-wrapper header-action-item header-action-item-select">
                          <div class="input-field d-flex flex-row justify-content-end align-items-center">
                            <span class="page-size-label">Item to Show</span>
                            <select onchange="onPageSizeChanged()" id="page-size">
                              <option value="10">10</option>
                              <option value="20">20</option>
                              <option value="50">50</option>
                            </select>
                          </div>
                        </div>
                        <div class="input-field-wrapper header-action-item header-action-item-select header-action-item-select-vendoe">
                          <div class="input-field d-flex flex-row justify-content-end align-items-center">
                            <span class="page-size-label">Bill To</span>
                            <select onchange="onPageSizeChanged()" id="page-size">
                              <option value="10">Vendor-1</option>
                              <option value="20">Vendor-2</option>
                            </select>
                          </div>
                        </div>
                        <!-- <button type="button" class="button-stroked button-primary header-action-item"><i class="fas fa-filter"></i> Filter</button>
                        <button type="button" class="button-stroked button-primary header-action-item"><i class="fas fa-sort"></i> Sort</button> -->
                        <!-- <button type="button" class="button-stroked button-primary header-action-item"><i class="fas fa-download"></i></button> -->
                      </div>
                    </div>
                  </div>
                  <div id="datatable" class="datatable ag-theme-material"></div>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>


  <script src="js/vendor/modernizr-3.8.0.min.js"></script>
  <script src="js/vendor/jquery-3.4.1.min.js"></script>
  <script src="js/vendor/ag-grid-enterprise.min.js"></script>
  <script src="js/vendor/flatpickr.js"></script>
  <script src="js/vendor/materialize.min.js"></script>


  <script src="js/main.js"></script>

  <script>
    var gridOptions, gridData=[];
      var columnDefs = [
        {
          headerName: "UPC", 
          field: "upc",
          editable: false
        },
        {headerName: "Store", field: "store", editable: true},
        {headerName: "Vendor", field: "vendor", editable: true},
        {headerName: "Cost Type", field: "cost_type", editable: true},
        {headerName: "Allowance Type", field: "allowance_type", editable: true},
        {headerName: "Amount", field: "amount", editable: true},
        {headerName: "Ad Fee", field: "ad_fee", editable: true},
        {headerName: "Start Date", field: "start_date", editable: true, cellClass: function(params) { return params.value === '21-12-2018' ? 'data-error' : ''; }},
        {headerName: "End Date", field: "end_date", editable: true, cellClass: function(params) { return params.value === '18-10-2019' ? 'data-error' : ''; }},
        // {headerName: "Action", field: "button", cellRenderer: 'actionCellRender', editable: false}
      ];
      $.get("data/deals.json", function(data, status){
        $(data).each(function(item) {

          if(this.start_date === '12-21-2018'){
            this.start_date = '21-12-2018'
          }

          if(this.end_date === '10-18-2019'){
            this.end_date = '18-10-2019'
          }

          gridData.push(this);
        });
        gridOptions = {
          defaultColDef: {
            editable: false,
            resizable: true,
            sortable:true,
          },
          singleClickEdit: false,
          stopEditingWhenGridLosesFocus: false,
          columnDefs: columnDefs,
          rowData: gridData,
          editType: 'fullRow',
          pagination: true,
          paginationPageSize: 10,
          paginationNumberFormatter: function(params) {
              return '[' + params.value.toLocaleString() + ']';
          },
          onGridReady: function(params) {
            params.api.sizeColumnsToFit();
          },
          onRowValueChanged: function(event) {
              var data = event.data;
              M.toast({html: 'Vale for '+data.upc+' value changed.'})
              // console.log('onRowValueChanged: (' + data.upc + ', ' + data.vendor + ', ' + data.OI + ', ' + ', ' + data.scan_backs + ', ' + data.ad_fee + ')');
          },
          // components: {
          //   actionCellRender: ActionCellRender
          // }
        };
        var gridDiv = document.querySelector('#datatable');
        new agGrid.Grid(gridDiv, gridOptions);    
      });

    function onPageSizeChanged(newPageSize) {
      var value = document.getElementById('page-size').value;
      gridOptions.api.paginationSetPageSize(Number(value));
    }

    function onBtStartEditing() {
        gridOptions.api.setFocusedCell(2, 'make');
        gridOptions.api.startEditingCell({
            rowIndex: 2,
            colKey: 'make'
        });
    }

    function ActionCellRender() {
    }

    ActionCellRender.prototype.init = function (params) {
        this.eGui = document.createElement('div');
        this.eGui.classList.add('button-wrapper')
        
        if (params.value !== "" || params.value !== undefined || params.value !== null) {
          this.eGui.innerHTML = '<button type="button" class="button-stroked button-primary table-button-edit"><i class="fas fa-edit"></i></button><button type="button" class="button-stroked button-primary table-button-save"><i class="far fa-save"></i></button><button type="button" class="button-stroked button-primary table-button-clancel"><i class="fas fa-times"></i></button>';
        }
    };

    ActionCellRender.prototype.getGui = function () {
        return this.eGui;
    };

    $(document).ready(function() { 
      $(window).on("load resize ",function(e){
        $('#datatable').outerHeight($(document).outerHeight(true) - $('.header-container').outerHeight(true) - $('.header-search-card-wrapper').outerHeight(true) - $('.main-body-data-wrapper .card-header').outerHeight(true) - 40);
      });


      $('body').on('click', '.table-button-edit', function(event) {
        // debugger;
        event.stopPropagation();
        var rowIndex = parseInt($(this).closest('.ag-row').attr('row-index'));
        gridOptions.api.setFocusedCell(rowIndex, 'make');
        gridOptions.api.startEditingCell({
        rowIndex: rowIndex,
        colKey: 'make'
    });
      });
    });
  </script>

  <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-XXXXX-Y', 'auto'); ga('set','transport','beacon'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async></script>
</body>

</html>